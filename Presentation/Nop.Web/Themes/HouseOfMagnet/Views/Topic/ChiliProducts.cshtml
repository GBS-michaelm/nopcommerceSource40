@model TopicModel
@using Nop.Web.Models.Catalog;
@using Nop.Web.Models.Topics;
@using Nop.Core.Infrastructure;
@using Nop.Services.Logging;
@{

    string page = string.Empty;
    try
    {
        string iframeUrl = TempData["iframeurl"].ToString();
        string urlEnd = TempData.Peek("pcode").ToString()+ "&top=DF&designtype=CC";
        page = iframeUrl + urlEnd;
    }
    catch (Exception ex)
    {
        page = string.Empty;
    }
}
<form id="product-attributes-form">
    @{
        try
        {
            int i = 0;
            string value = string.Empty;
            if (!string.IsNullOrEmpty(TempData.Peek("productAttributes").ToString()))
            {
                foreach (var item in (IList<ProductDetailsModel.ProductAttributeModel>)TempData.Peek("productAttributes"))
                {
                    <input name="product_attribute_@item.Id" class="@item.Name" type="hidden" id="product_attribute_@item.Id" value="@value" />
                    i++;
                }
            }
        }
        catch (Exception ex)
        {

        }
    }

</form>
@{

    <div class="chili-template" style="overflow:hidden; height:@TempData.Peek("iframeheight")">
        <iframe src="@T("hom.url")@page" style="height:@TempData["iframeheight"]; width:100%;"></iframe>
    </div>
}
<!--product attributes-->

<script type="text/javascript">
    var eventMethod = window.addEventListener ? "addEventListener" : "attachEvent";
    var eventer = window[eventMethod];
    var messageEvent = eventMethod == "attachEvent" ? "onmessage" : "message";
    var prodID = @Html.Raw(TempData["productid"]);
    var cID =  @Html.Raw(TempData["cartid"]);
    var imageUrl = '';
    var check = true;

    // Listen to message from child window
    eventer(messageEvent, function (e) {
        if (JSON.parse(e.data).success == true) {
            if (check) {
                check = addToCart(e.data);
            }
        }
    }, false);
    function addToCart(val) {
        $(".CustomImgUrl").val(JSON.parse(val).preview);
        AjaxCart.addproducttocart_details('@Url.RouteUrl("AddProductToCart-Details", new { productId = TempData["productID"], shoppingCartTypeId = TempData["cartID"] })', '#product-attributes-form');
        return false;
    }
</script>

