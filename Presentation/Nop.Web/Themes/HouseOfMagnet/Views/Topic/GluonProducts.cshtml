@model TopicModel
@using Nop.Web.Models.Catalog;
@using Nop.Web.Models.Topics;
@using Nop.Core.Infrastructure;
@using Nop.Services.Logging;
@{

    string page = string.Empty;
    try
    {
        TempData["type"] = Request.QueryString["type"];
        var id = Request.QueryString["pageID"];
        TempData["code"] = Request.QueryString["pcode"];
        TempData["cartID"] = Request.QueryString["cartID"];
        TempData["productID"] = Request.QueryString["productID"];


        Dictionary<string, string> pages = new Dictionary<string, string>();
        pages.Add("BC", "nop/business-cards/bc.aspx?pageID=");
        pages.Add("NP", "nop/name-plates/np.aspx?pageID=");


        string urlEnd = "&pcode=" + TempData.Peek("code").ToString();

        page = pages[TempData.Peek("type").ToString()] + id + urlEnd;
        page = page.Replace(" ", string.Empty);
    }
    catch (Exception ex)
    {
        page = string.Empty;
    }
}
<form id="product-attributes-form">
@{
    try
    {
        int i = 0;
        string value = string.Empty;
        if (!string.IsNullOrEmpty(TempData.Peek("productAttributes").ToString()))
        {
            foreach (var item in (IList<ProductDetailsModel.ProductAttributeModel>)TempData.Peek("productAttributes"))
            {
                <input name="product_attribute_@item.Id" class="@item.Name" type="hidden" id="product_attribute_@item.Id" value="@value"/>
                i++;
            }
        }
    }
    catch (Exception ex)
    {

    }
}

</form>
@{
    Dictionary<string, string> heightDict = new Dictionary<string, string>();
    heightDict.Add("BC", "1275px");
    heightDict.Add("NP", "800px");
    string height = heightDict[TempData["type"].ToString()];

    <div class="gluon-template" style="overflow:hidden; height:@height;">
        <iframe src="@T("hom.url")@page" style="height:@height; width:100%;"></iframe>
    </div>
}
 <!--product attributes-->

<script type="text/javascript">
    var eventMethod = window.addEventListener ? "addEventListener" : "attachEvent";
    var eventer = window[eventMethod];
    var messageEvent = eventMethod == "attachEvent" ? "onmessage" : "message";
    var prodID = @Html.Raw(TempData["productID"]);
    var cID =  @Html.Raw(TempData["cartID"]);
    var imageUrl = '';
    var check = true;

    // Listen to message from child window
    eventer(messageEvent, function (e) {
        if (JSON.parse(e.data).success == true) {
            if (check) {
                check = addToCart(e.data);
            }
        }
    }, false);
    function addToCart(val) {
        $(".CustomImgUrl").val(JSON.parse(val).preview);
        AjaxCart.addproducttocart_details('@Url.RouteUrl("AddProductToCart-Details", new { productId = TempData["productID"], shoppingCartTypeId = TempData["cartID"] })', '#product-attributes-form');
        return false;
    }
</script>

