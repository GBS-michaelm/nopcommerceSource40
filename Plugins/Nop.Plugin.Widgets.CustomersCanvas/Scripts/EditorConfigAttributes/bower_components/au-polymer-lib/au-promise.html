<script>
var AurigmaPromise = window.AurigmaPromise = function() {
        var self = this;
        self._addCallback = function(cb, arr) {
            if (self.resolved) {
                return cb(self.result);
            } else {
                var resProm = new AurigmaPromise();
                arr.push(function() {
                    return resProm.resolve(cb(arguments[0]));
                });
                return resProm;
            }
        };
        self.then = function(cb) {
            return self._addCallback(cb, self.onOks);
        };
        self.catch = function(cb) {
            return self._addCallback(cb, self.onFails);
        };
        self.resolved = false;
        self.result = null;
        self.onOks = [];
        self.onFails = [];
        self._exec = function(cb, arg) {
            if (typeof(cb) === 'function') {
                cb(arg);
            }
        }
        self.resolve = function(val) {
            self.onOks.forEach(function(cb) {
                if (typeof(val.then) === 'function') {
                    val.then(function() {
                        self._exec(cb, arguments[0]);
                    });
                } else {
                    self._exec(cb, val);
                }
            });
            self.resolved = true;
            self.result = val;
            self.onOks.splice(0, self.onOks.length);
            return self;
        }
        this.fail = function(val) {
            self.onFails.forEach(function(cb) {
                self._exec(cb, val);
            })
            self.resolved = true;
            self.result = val;
            self.onFails.splice(0, self.onFails.length);
            return self;
        }
    }
</script>
