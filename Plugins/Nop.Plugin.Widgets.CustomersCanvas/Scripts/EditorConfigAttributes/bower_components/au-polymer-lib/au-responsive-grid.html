<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../iron-media-query/iron-media-query.html">
<link rel="import" href="../iron-resizable-behavior/iron-resizable-behavior.html">
<dom-module id="au-responsive-grid">
    <template>

        <style>
            :host{
                flex: 0 0 auto;
                 --au-responsive-grid-layout:{
                    display: inline-flex;
                    flex-direction: row;
                 };
                 @apply(--au-responsive-grid-layout);
                --au-responsive-grid-1-width: 8.33333%;
                --au-responsive-grid-2-width: 16.66667%;
                --au-responsive-grid-3-width: 25%;
                --au-responsive-grid-4-width: 33.33333%;
                --au-responsive-grid-5-width: 41.66667%;
                --au-responsive-grid-6-width: 50%;
                --au-responsive-grid-7-width: 58.33333%;
                --au-responsive-grid-8-width: 66.66667%;
                --au-responsive-grid-9-width: 75%;
                --au-responsive-grid-10-width: 83.33333%;
                --au-responsive-grid-11-width: 91.66667%;
                --au-responsive-grid-12-width: 100%;
            }

             ::content .xs0-apply {
                display: none;
             }
             ::content .xs1-apply {
               flex: 1 1  var(--au-responsive-grid-1-width);
                @apply(--au-responsive-grid-layout);
             }
              ::content .xs2-apply {
               flex: 1 1  var(--au-responsive-grid-2-width);
                @apply(--au-responsive-grid-layout);
             }
           ::content .xs3-apply {
                flex: 1 1  var(--au-responsive-grid-3-width);
                @apply(--au-responsive-grid-layout);
             }
              ::content .xs4-apply {
               flex: 1 1  var(--au-responsive-grid-4-width);
                @apply(--au-responsive-grid-layout);
             }
               ::content .xs5-apply {
               flex: 1 1  var(--au-responsive-grid-5-width);
                @apply(--au-responsive-grid-layout);
             }
            ::content .xs6-apply {
               flex: 1 1  var(--au-responsive-grid-6-width);
                @apply(--au-responsive-grid-layout);
             }
              ::content .xs7-apply {
               flex: 1 1  var(--au-responsive-grid-7-width);
                @apply(--au-responsive-grid-layout);
             }
              ::content .xs8-apply {
               flex: 1 1  var(--au-responsive-grid-8-width);
                @apply(--au-responsive-grid-layout);
             }
              ::content .xs9-apply {
               flex: 1 1  var(--au-responsive-grid-9-width);
                @apply(--au-responsive-grid-layout);
             }
               ::content .xs10-apply {
               flex: 1 1  var(--au-responsive-grid-10-width);
                @apply(--au-responsive-grid-layout);
             }
              ::content .xs11-apply {
               flex: 1 1  var(--au-responsive-grid-11-width);
                @apply(--au-responsive-grid-layout);
             }
              ::content .xs12-apply {
               flex: 1 1  var(--au-responsive-grid-12-width);
                @apply(--au-responsive-grid-layout);
             }

             /**================================s*/

            ::content .s0-apply {
                display: none;
             }
             ::content .s1-apply {
               flex: 1 1  var(--au-responsive-grid-1-width);
                @apply(--au-responsive-grid-layout);
             }
              ::content .s2-apply {
               flex: 1 1  var(--au-responsive-grid-2-width);
                @apply(--au-responsive-grid-layout);
             }
           ::content .s3-apply {
               flex: 1 1  var(--au-responsive-grid-3-width);
                @apply(--au-responsive-grid-layout);
             }
              ::content .s4-apply {
               flex: 1 1  var(--au-responsive-grid-4-width);
                @apply(--au-responsive-grid-layout);
             }
               ::content .s5-apply {
               flex: 1 1  var(--au-responsive-grid-5-width);
                @apply(--au-responsive-grid-layout);
             }
            ::content .s6-apply {
               flex: 1 1  var(--au-responsive-grid-6-width);
                @apply(--au-responsive-grid-layout);
             }
              ::content .s7-apply {
               flex: 1 1  var(--au-responsive-grid-7-width);
                @apply(--au-responsive-grid-layout);
             }
              ::content .s8-apply {
               flex: 1 1  var(--au-responsive-grid-8-width);
                @apply(--au-responsive-grid-layout);
             }
              ::content .s9-apply {
               flex: 1 1  var(--au-responsive-grid-9-width);
                @apply(--au-responsive-grid-layout);
             }
               ::content .s10-apply {
               flex: 1 1  var(--au-responsive-grid-10-width);
                @apply(--au-responsive-grid-layout);
             }
              ::content .s11-apply {
               flex: 1 1  var(--au-responsive-grid-11-width);
                @apply(--au-responsive-grid-layout);
             }
              ::content .s12-apply {
               flex: 1 1  var(--au-responsive-grid-12-width);
                @apply(--au-responsive-grid-layout);
             }

             /**=======================================m*/

            ::content .m0-apply {
                display: none;
             }
             ::content .m1-apply {
               flex: 1 1  var(--au-responsive-grid-1-width);
                @apply(--au-responsive-grid-layout);
             }
              ::content .m2-apply {
               flex: 1 1  var(--au-responsive-grid-2-width);
                @apply(--au-responsive-grid-layout);
             }
           ::content .m3-apply {
               flex: 1 1  var(--au-responsive-grid-3-width);
                @apply(--au-responsive-grid-layout);
             }
              ::content .m4-apply {
               flex: 1 1  var(--au-responsive-grid-4-width);
                @apply(--au-responsive-grid-layout);
             }
               ::content .m5-apply {
               flex: 1 1  var(--au-responsive-grid-5-width);
                @apply(--au-responsive-grid-layout);
             }
            ::content .m6-apply {
               flex: 1 1  var(--au-responsive-grid-6-width);
                @apply(--au-responsive-grid-layout);
             }
              ::content .m7-apply {
               flex: 1 1  var(--au-responsive-grid-7-width);
                @apply(--au-responsive-grid-layout);
             }
              ::content .m8-apply {
               flex: 1 1  var(--au-responsive-grid-8-width);
                @apply(--au-responsive-grid-layout);
             }
              ::content .m9-apply {
               flex: 1 1  var(--au-responsive-grid-9-width);
                @apply(--au-responsive-grid-layout);
             }
               ::content .m10-apply {
               flex: 1 1  var(--au-responsive-grid-10-width);
                @apply(--au-responsive-grid-layout);
             }
              ::content .m11-apply {
               flex: 1 1  var(--au-responsive-grid-11-width);
                @apply(--au-responsive-grid-layout);
             }
              ::content .m12-apply {
               flex: 1 1  var(--au-responsive-grid-12-width);
                @apply(--au-responsive-grid-layout);
             }

             /**=====================================l*/

            ::content .l0-apply {
                display: none;
             }
             ::content .l1-apply {
               flex: 1 1  var(--au-responsive-grid-1-width);
                @apply(--au-responsive-grid-layout);
             }
              ::content .l2-apply {
               flex: 1 1  var(--au-responsive-grid-2-width);
                @apply(--au-responsive-grid-layout);
             }
           ::content .l3-apply {
               flex: 1 1  var(--au-responsive-grid-3-width);
                @apply(--au-responsive-grid-layout);
             }
              ::content .l4-apply {
               flex: 1 1  var(--au-responsive-grid-4-width);
                @apply(--au-responsive-grid-layout);
             }
               ::content .l5-apply {
               flex: 1 1  var(--au-responsive-grid-5-width);
                @apply(--au-responsive-grid-layout);
             }
            ::content .l6-apply {
               flex: 1 1  var(--au-responsive-grid-6-width);
                @apply(--au-responsive-grid-layout);
             }
              ::content .l7-apply {
               flex: 1 1  var(--au-responsive-grid-7-width);
                @apply(--au-responsive-grid-layout);
             }
              ::content .l8-apply {
               flex: 1 1  var(--au-responsive-grid-8-width);
                @apply(--au-responsive-grid-layout);
             }
              ::content .l9-apply {
               flex: 1 1  var(--au-responsive-grid-9-width);
                @apply(--au-responsive-grid-layout);
             }
               ::content .l10-apply {
               flex: 1 1  var(--au-responsive-grid-10-width);
                @apply(--au-responsive-grid-layout);
             }
              ::content .l11-apply {
               flex: 1 1  var(--au-responsive-grid-11-width);
                @apply(--au-responsive-grid-layout);
             }
              ::content .l12-apply {
               flex: 1 1  var(--au-responsive-grid-12-width);
                @apply(--au-responsive-grid-layout);
             }

        </style>
        <iron-media-query query="(min-width: 0px)" query-matches="{{isXs}}"></iron-media-query>
        <iron-media-query query="(min-width: 960px)" query-matches="{{isS}}"></iron-media-query>
        <iron-media-query query="(min-width: 1280px)" query-matches="{{isM}}"></iron-media-query>
        <iron-media-query query="(min-width: 1600px)" query-matches="{{isL}}"></iron-media-query>
        <content></content>
    </template>
    <script>

    Polymer({
        is: 'au-responsive-grid',
        behaviors: [
          Polymer.IronResizableBehavior
        ],
         listeners: {
          'iron-resize': '_toggleClass'
        },
        properties:{
            isXs:{
                type: Boolean,
                value: false,
                notify: true,
                observer: '_toggleClass'
            },
            isS:{
                type: Boolean,
                value: false,
                notify: true,
                observer: '_toggleClass'
            },
            isM:{
                type: Boolean,
                value: false,
                notify: true,
                observer: '_toggleClass'
            },
            isM:{
                type: Boolean,
                value: false,
                notify: true,
                observer: '_toggleClass'
            },
            columns:{
                type: String,
                value: "",
                notify: true,
                observer: '_toggleClass'
            },
        },
        
         _findClass:function(element,toFind,callback){
           Array.prototype.slice.call(element.classList).forEach(function(el,idx,list){
                if((new RegExp(toFind, 'g')).test(el)){
                    callback(el, element.classList);
                }
            });
         },
        _toggleClass:function(){
             if(typeof this.isXs == "undefined" ||
                typeof this.isS == "undefined" ||
                typeof this.isM == "undefined" ||
                typeof this.isL == "undefined" ||
                typeof this.columns == "undefined"){
                    return;
                }
             var toggler = function(element){
                this._findClass(element, "-apply", function(el,list){
                    list.remove(el);
                });
              
                if(this.isXs || this.isS || this.isM || this.isL){
                    var found = false;
                    var classArr = [];
                     if(this.isL){
                       var classArr = ["l\\d","m\\d","s\\d","xs\\d"];
                       while(!found && classArr.length > 0){
                            this._findClass(element, classArr.shift(), function(el,list){
                                found = true;
                                if(el.indexOf("-apply") == -1){
                                    list.add(el + "-apply");
                                }
                            });
                        }
                    }else if(this.isM){
                        var classArr = ["m\\d","s\\d","xs\\d"];
                        while(!found && classArr.length > 0){
                                this._findClass(element, classArr.shift(), function(el,list){
                                    found = true;
                                    if(el.indexOf("-apply") == -1){
                                        list.add(el + "-apply");
                                    }
                                });
                        }
                    }else if(this.isS){
                        var classArr = ["s\\d","xs\\d"];
                        while(!found && classArr.length > 0){
                                this._findClass(element, classArr.shift(), function(el,list){
                                    found = true;
                                    if(el.indexOf("-apply") == -1){
                                        list.add(el + "-apply");
                                    }
                                });
                        }
                    }else if(this.isXs){
                        var classArr = ["xs\\d","s\\d","m\\d","l\\d"];
                        while(!found && classArr.length > 0){
                                this._findClass(element, classArr.shift(), function(el,list){
                                    found = true;
                                    if(el.indexOf("-apply") == -1){
                                        list.add(el + "-apply");
                                    }
                                });
                        }
                    }
                  
                }
             }.bind(this);

             if(this.children.length> 0){
                Array.prototype.slice.call(this.children, 4).forEach(function(ch){
                    toggler(ch);
                });
             }

             var colummnsArray = (this.columns || "").split(" ");
             var resultDirectionColumn = false;

             switch(true){
                case this.isL:
                     if(colummnsArray.indexOf("l") > -1){ resultDirectionColumn = true;}
                     break;
                case this.isM:
                     if(colummnsArray.indexOf("m") > -1){resultDirectionColumn = true;}
                     break;
                case this.isS:
                     if(colummnsArray.indexOf("s") > -1){ resultDirectionColumn = true;}
                     break;
             case this.isXs:
                     if(colummnsArray.indexOf("xs") > -1){ resultDirectionColumn = true;}
                     break;
              
             }

             this.style.flexDirection = resultDirectionColumn ? "column" : "row";
        },
        attached:function(){
            this._toggleClass();
            Array.prototype.slice.call(this.children, 4).forEach(function(ch){
                   ch.classList.add(this._scopeSelector);
            }.bind(this));
        }

    });
    </script>
</dom-module>