<link rel="import" href="../paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../paper-listbox/paper-listbox.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../iron-resizable-behavior/iron-resizable-behavior.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">
<dom-module id="aurigma-color-scheme-picker">
<style>
  :host{
    display:block;
    margin:5px;

    --aurigma-color-scheme-picker-color: black;
    --paper-input-container-color:var(--aurigma-color-scheme-picker-color);
    --paper-input-container-focus-color:var(--aurigma-color-scheme-picker-color);
    --paper-input-container-invalid-color:var(--aurigma-color-scheme-picker-color);
    --paper-input-container-input-color:var(--aurigma-color-scheme-picker-color);
  
    --paper-item-focused:{
       filter: brightness(90%);
    }
    --paper-item-selected:{
       filter: brightness(90%);
    };
    --paper-item:{
       border: white 1px solid;
    };
  }
  paper-dropdown-menu{
    width:100%;
  }

  paper-listbox{
    width :100%;
    max-height: var(--aurigma-color-scheme-picker-max-menu-height, 300px);
    overflow-y: auto;
  }

  paper-listbox::-webkit-scrollbar-track
  {
    box-shadow: inset 0 0 6px rgba(0,0,0,0.3);
    border-radius: 10px;
    background-color: #F5F5F5;
  }

  paper-listbox::-webkit-scrollbar
  {
    width:12px;
    background-color: #F5F5F5;
  }

  paper-listbox::-webkit-scrollbar-thumb
  {
    border-radius: 10px;
    box-shadow: inset 0 0 6px rgba(0,0,0,.3);
    background-color: #555;
  }
  .color-square{
    display: inline-block;
    width:10px;
    height:10px;
    border: gray 1px solid;
  }
  .color-title,.color-palette{
    display: inline-block;
    width:100%;
  }
  .color-item{
      @apply --layout-vertical;
      @apply --layout-center-center;
  }
  </style>
  <template>
  <paper-dropdown-menu label="{{title}}" disabled$="{{!enabled}}" on-iron-select="_selectedTrigger" vertical-align="top">
    <paper-listbox class="dropdown-content" style$="width:[[elementWidth]];" selected="{{defaultSchemeIndex}}">
      <template is="dom-repeat" items="{{colorSchemes}}">
         <paper-item style$="background-color:[[_getArrayElement(item.palette,item.primaryColorIndex)]];color:[[_getArrayElement(item.palette,item.secondaryColorIndex)]];">
              <div class="color-item">
                <span class="color-title">[[item.name]]</span>
                  <template is="dom-if" if="{{showPalettePreview}}">
                    <div class="color-palette">
                      <template is="dom-repeat" items="[[_checkMaxNumber(item.palette)]]" as="item_pallete" index-as="itempallete_no">
                          <div class="color-square" style$="background-color:[[_cmykToRgb(item_pallete)]];"></div>
                      </template>
                    </div>
                 </template>
              </div>
        </paper-item>
      </template>
    </paper-listbox>
  </paper-dropdown-menu>
</template>
</dom-module>
<script>
  Polymer({
      is: 'aurigma-color-scheme-picker',
      properties: {
        title:{
          type:String,
          value:"items"
        },
        colorSchemes:{
          type:Array,
          value:[]
        },
        defaultSchemeIndex:{
           type:Number,
           value:-1
        },
        showPalettePreview:{
           type:Boolean,
           value:true
        },
        previewPaletteMaxNumber:{
           type:Number,
           value:8
        },
        enabled:{
           type:Boolean,
           value:true
        },
        elementWidth:{
           type:String,
           value:""
        }

      },
      _selectedTrigger:function(){
          this.fire('change', this.colorSchemes[this.defaultSchemeIndex]);
      }, 
      _checkMaxNumber:function(palletes){
        return palletes.slice(0,this.previewPaletteMaxNumber); 
      },
      _cmykToRgb:function(pallete){
          return /device-cmyk/.test(pallete) ? pallete.match(/rgb\([^\)]+\)/)[0] : pallete;
      },
      behaviors: [
        Polymer.IronResizableBehavior
      ],
      listeners: {
        'iron-resize': '_onIronResize'
      },
      _getArrayElement:function(array,index){
          return this._cmykToRgb(array[index]);
      },
      _onIronResize:function(){
        this.elementWidth = this.clientWidth + "px"
      },
      attached: function() {
        this.async(function(){
           this.notifyResize();
        },1);
      },
  });
</script>
