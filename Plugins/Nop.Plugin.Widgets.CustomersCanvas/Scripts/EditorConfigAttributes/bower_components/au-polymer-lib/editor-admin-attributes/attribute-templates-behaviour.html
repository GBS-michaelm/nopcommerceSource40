<script>
AttributeTemplatesBehaviour = {
    properties: {
        ccUrl: {
            type: String,
        },
        folder: {
            type: String,
        },
        rootFolder: {
            type: String,
            observer: "_rootFolderObserver",
        }
    },

    _rootFolderObserver: function(newValue, oldValue) {
        if (!!newValue) {
            if (!newValue[newValue.length - 1] !== "/") {
                this.rootFolder += "/";
            }
        }
    },

    _getTemplates: function() {
        var self = this;
        var url = this.ccUrl + "/api/ProductTemplates/" + this.folder + "/";
        var xhr = new XMLHttpRequest();
        xhr.open("GET", url, true);
        xhr.onreadystatechange = function() {
            if (xhr.readyState !== 4)
                return;

            var status = xhr.status;
            var data = JSON.parse(JSON.stringify(xhr.responseText));

            if (status >= 200 && status < 300)
                onSuccess(data);
            else
                onError();

            function onSuccess(data) {
                if (data != '') {
                    data = JSON.parse(data);
                    data = data.filter(function(item) {
                        if (item.indexOf(self.rootFolder) > -1) {
                            return true;
                        } else {
                            return false;
                        }
                    });
                    data = data.map(function(item) {
                        return item.replace(self.rootFolder, "");
                    });
                    self._handleTemplates(data);
                }
            };

            function onError() {
                console.error("Can't get files from CC api");
                self._handleTemplates(null);
            };
        };
        xhr.send();
    },

    _handleTemplates: function(templatesArray) {
        /*
            need realize in component
        */
    },

    _getTemplatePic: function(templateName, height, width) {
        var _heigth = 200;
        var _width = 200;
        if (height && typeof(height) === "number")
            _heigth = height;
        if (width && typeof(width) === "number")
            _width = width;

        var url = this.ccUrl + "/api/ProductTemplates/" + this.folder + "/" + this.rootFolder + templateName;
        url += "?width=" + _width + "&height=" + _heigth;
        return url;
    },

};
</script>
